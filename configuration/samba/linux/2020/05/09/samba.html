<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>A basic SAMBA share for home networks | Ian’s Blog</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="A basic SAMBA share for home networks" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Simple (but not super secure) SAMBA shares for the home user" />
<meta property="og:description" content="Simple (but not super secure) SAMBA shares for the home user" />
<link rel="canonical" href="https://blog.ianpreston.ca/configuration/samba/linux/2020/05/09/samba.html" />
<meta property="og:url" content="https://blog.ianpreston.ca/configuration/samba/linux/2020/05/09/samba.html" />
<meta property="og:site_name" content="Ian’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-09T00:00:00-05:00" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.ianpreston.ca/configuration/samba/linux/2020/05/09/samba.html"},"url":"https://blog.ianpreston.ca/configuration/samba/linux/2020/05/09/samba.html","@type":"BlogPosting","headline":"A basic SAMBA share for home networks","dateModified":"2020-05-09T00:00:00-05:00","datePublished":"2020-05-09T00:00:00-05:00","description":"Simple (but not super secure) SAMBA shares for the home user","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://blog.ianpreston.ca/feed.xml" title="Ian's Blog" /><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Ian&#39;s Blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">A basic SAMBA share for home networks</h1><p class="page-description">Simple (but not super secure) SAMBA shares for the home user</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-05-09T00:00:00-05:00" itemprop="datePublished">
        May 9, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      4 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#configuration">configuration</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#samba">samba</a>
        &nbsp;
      
        <a class="category-tags-link" href="/categories/#linux">linux</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#intro">Intro</a>
<ul>
<li class="toc-entry toc-h2"><a href="#edit-october-2020">Edit October 2020</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#password-free-server-on-a-linux-box">Password free server on a Linux box</a>
<ul>
<li class="toc-entry toc-h2"><a href="#what-im-installing-this-on">What I’m installing this on</a></li>
<li class="toc-entry toc-h2"><a href="#the-steps">The steps</a>
<ul>
<li class="toc-entry toc-h3"><a href="#install-samba">Install samba</a></li>
<li class="toc-entry toc-h3"><a href="#backup-any-existing-smbconf-and-then-update">Backup any existing smb.conf and then update</a></li>
<li class="toc-entry toc-h3"><a href="#restart-and-enable-samba-give-it-a-test">Restart and enable SAMBA, give it a test</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#no-password-conclusion">No Password Conclusion</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#mounting-shares-from-a-nas">Mounting shares from a NAS</a>
<ul>
<li class="toc-entry toc-h2"><a href="#create-a-credentials-file">Create a credentials file</a></li>
<li class="toc-entry toc-h2"><a href="#find-the-appropriate-uid-and-gid-to-assign-ownership">Find the appropriate UID and GID to assign ownership</a></li>
<li class="toc-entry toc-h2"><a href="#create-the-fstab-entry">Create the fstab entry</a></li>
<li class="toc-entry toc-h2"><a href="#nas-conclusion">NAS Conclusion</a></li>
</ul>
</li>
</ul><h1 id="intro">
<a class="anchor" href="#intro" aria-hidden="true"><span class="octicon octicon-link"></span></a>Intro</h1>

<h2 id="edit-october-2020">
<a class="anchor" href="#edit-october-2020" aria-hidden="true"><span class="octicon octicon-link"></span></a>Edit October 2020</h2>

<p>The original post dealt with setting up a share from an Ubuntu server to provide read/write access without a password. Since writing that part I purchased a Synology NAS and am now including sections on setting up shares for that.</p>

<p>Most SAMBA guides I find online are some combination of out of date or focused on the enterprise. My objective is to  provide a quick reference for setting up files shares from a Linux server to Windows clients, or to properly mount SAMBA shares from a NAS device onto Linux clients. This is only appropriate for a home network. In the case of the Linux server I’m sacrificing security/specific user permissions for being easily able to connect to my file share. On a small LAN where I can easily physically monitor the devices I think this is worth it. Clearly you should not do this for an organization or if you have more sensitive data you’re sharing.</p>

<h1 id="password-free-server-on-a-linux-box">
<a class="anchor" href="#password-free-server-on-a-linux-box" aria-hidden="true"><span class="octicon octicon-link"></span></a>Password free server on a Linux box</h1>

<h2 id="what-im-installing-this-on">
<a class="anchor" href="#what-im-installing-this-on" aria-hidden="true"><span class="octicon octicon-link"></span></a>What I’m installing this on</h2>

<p>The current server I’m running this on is an Ubuntu 18.04 machine. Hopefully most of this will translate to similar setups. I’m sure I’ll be upgrading the OS soon so I’ll edit this if I encounter any breaking changes.</p>

<h2 id="the-steps">
<a class="anchor" href="#the-steps" aria-hidden="true"><span class="octicon octicon-link"></span></a>The steps</h2>

<h3 id="install-samba">
<a class="anchor" href="#install-samba" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install samba</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>samba
</code></pre></div></div>

<h3 id="backup-any-existing-smbconf-and-then-update">
<a class="anchor" href="#backup-any-existing-smbconf-and-then-update" aria-hidden="true"><span class="octicon octicon-link"></span></a>Backup any existing smb.conf and then update</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># If you have one already</span>
<span class="nb">sudo mv</span> /etc/samba/smb.conf /etc/samba/smb.conf.bak
</code></pre></div></div>

<p>Now setup the new <code class="language-plaintext highlighter-rouge">smb.conf</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>global]
        map to guest <span class="o">=</span> Bad User
        logging <span class="o">=</span> systemd
        log level <span class="o">=</span> 1
        guest account <span class="o">=</span> &lt;username&gt;

<span class="o">[</span>data]
        <span class="c"># This share allows guest read write access</span>
        <span class="c"># without authentication, hope you trust everyone on your LAN</span>
        path <span class="o">=</span> /mnt/data/ <span class="c"># Or whatever folder you're sharing</span>
        <span class="nb">read </span>only <span class="o">=</span> no
        guest ok <span class="o">=</span> <span class="nb">yes
        </span>guest only <span class="o">=</span> <span class="nb">yes</span>
</code></pre></div></div>

<p>Where &lt;username&gt; is the user on your samba server that has appropriate access to the folder you’re sharing.</p>

<p>After saving the config file you can run <code class="language-plaintext highlighter-rouge">testparm</code> to see if there are any syntax errors.</p>

<h3 id="restart-and-enable-samba-give-it-a-test">
<a class="anchor" href="#restart-and-enable-samba-give-it-a-test" aria-hidden="true"><span class="octicon octicon-link"></span></a>Restart and enable SAMBA, give it a test</h3>

<p>From the samba server:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl status smbd <span class="c"># check if it's running</span>
<span class="c"># If it's running do this</span>
<span class="nb">sudo </span>systemctl restart smbd
<span class="c"># If it's not do this</span>
<span class="nb">sudo </span>systemctl start smbd
</code></pre></div></div>

<p>Try and connect from a Windows machine, make sure you can create and delete files. Back on the samba client you can check if the files you created have the right permissions (should be assigned to the user you created).</p>

<p>Assuming everything works enable the server so it will reload if you restart the machine. From the samba server:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemclt <span class="nb">enable </span>smbd
</code></pre></div></div>

<h2 id="no-password-conclusion">
<a class="anchor" href="#no-password-conclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>No Password Conclusion</h2>

<p>That’s it! Super simple but every time I tried to get a SAMBA share going in the past I always ended up struggling. Hopefully this guide will be helpful to future me and anyone else who’s got a similar situation.</p>

<h1 id="mounting-shares-from-a-nas">
<a class="anchor" href="#mounting-shares-from-a-nas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Mounting shares from a NAS</h1>

<p>This part is pretty straightforward, but there are always a few finicky bits that I have to google, so I’m recording the process here for the next time I have to set it up. Setting up the actual share on the NAS is outside the scope of this article. In my case I’m using a Synology box so it’s pretty much just point and click.</p>

<h2 id="create-a-credentials-file">
<a class="anchor" href="#create-a-credentials-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create a credentials file</h2>

<p>I’m going to try and pay a reasonable amount of attention to security in this implementation. The NAS has a user set up with read and write permissions for the share that I want to access. I’ll use the <a href="https://wiki.archlinux.org/index.php/samba#Storing_share_passwords">suggestions from the Arch Wiki</a> to set up a credential file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo mkdir</span> /etc/samba/credentials
<span class="nb">sudo echo</span> <span class="s2">"username=&lt;shareusername&gt;"</span> <span class="o">&gt;&gt;</span> /etc/samba/credentials/share
<span class="nb">sudo echo</span> <span class="s2">"password=&lt;sharepassword&gt;"</span> <span class="o">&gt;&gt;</span> /etc/samba/credentials/share
<span class="nb">sudo chown </span>root:root /etc/samba/credentials/share
<span class="nb">sudo chmod </span>700 /etc/samba/credentials
<span class="nb">sudo chmod </span>600 /etc/samba/credentials/share
</code></pre></div></div>

<h2 id="find-the-appropriate-uid-and-gid-to-assign-ownership">
<a class="anchor" href="#find-the-appropriate-uid-and-gid-to-assign-ownership" aria-hidden="true"><span class="octicon octicon-link"></span></a>Find the appropriate UID and GID to assign ownership</h2>

<p>When creating the <code class="language-plaintext highlighter-rouge">/etc/fstab</code> entry for the share mount we want to assign ownership to the user that will actually be accessing the files. This is done by UID and GID. For my single user systems that’s usually 1000:1000 but I like to double check and I usually have to look up the command so here it is.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">id</span> <span class="nt">-u</span> &lt;username&gt;
<span class="nb">id</span> <span class="nt">-g</span> &lt;username&gt;
</code></pre></div></div>

<p>Will give the UID and GID for user <username></username></p>

<h2 id="create-the-fstab-entry">
<a class="anchor" href="#create-the-fstab-entry" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create the fstab entry</h2>

<p>Now we just need to create an entry in fstab to the share:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//&lt;server&gt;/&lt;share_path&gt; /mnt/&lt;share_point&gt; cifs _netdev,uid<span class="o">=</span>&lt;uid&gt;,gid<span class="o">=</span>&lt;gid&gt;,credentials<span class="o">=</span>/etc/samba/credentials/share 0 0
</code></pre></div></div>

<h2 id="nas-conclusion">
<a class="anchor" href="#nas-conclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>NAS Conclusion</h2>

<p>This extension to the post just has a few code snippets that I’ve found useful. There’s not a lot of exposition on why I’ve set things up the way I did. It’s more meant as a reference for future me, but hopefully it’s useful to others.</p>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="ianepreston/iblog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/configuration/samba/linux/2020/05/09/samba.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>My blog. Mostly about data, python, and Linux.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/ianepreston" title="ianepreston"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/iPrestonBC" title="iPrestonBC"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>

<h1 id="a-basic-samba-share-for-home-networks">A basic SAMBA share for home networks</h1>

<ol id="markdown-toc">
  <li><a href="#a-basic-samba-share-for-home-networks" id="markdown-toc-a-basic-samba-share-for-home-networks">A basic SAMBA share for home networks</a>    <ol>
      <li><a href="#intro" id="markdown-toc-intro">Intro</a>        <ol>
          <li><a href="#edit-october-2020" id="markdown-toc-edit-october-2020">Edit October 2020</a></li>
        </ol>
      </li>
      <li><a href="#password-free-server-on-a-linux-box" id="markdown-toc-password-free-server-on-a-linux-box">Password free server on a Linux box</a>        <ol>
          <li><a href="#what-im-installing-this-on" id="markdown-toc-what-im-installing-this-on">What I’m installing this on</a></li>
          <li><a href="#the-steps" id="markdown-toc-the-steps">The steps</a>            <ol>
              <li><a href="#install-samba" id="markdown-toc-install-samba">Install samba</a></li>
              <li><a href="#backup-any-existing-smbconf-and-then-update" id="markdown-toc-backup-any-existing-smbconf-and-then-update">Backup any existing smb.conf and then update</a></li>
              <li><a href="#restart-and-enable-samba-give-it-a-test" id="markdown-toc-restart-and-enable-samba-give-it-a-test">Restart and enable SAMBA, give it a test</a></li>
            </ol>
          </li>
          <li><a href="#no-password-conclusion" id="markdown-toc-no-password-conclusion">No Password Conclusion</a></li>
        </ol>
      </li>
      <li><a href="#mounting-shares-from-a-nas" id="markdown-toc-mounting-shares-from-a-nas">Mounting shares from a NAS</a>        <ol>
          <li><a href="#create-a-credentials-file" id="markdown-toc-create-a-credentials-file">Create a credentials file</a></li>
          <li><a href="#find-the-appropriate-uid-and-gid-to-assign-ownership" id="markdown-toc-find-the-appropriate-uid-and-gid-to-assign-ownership">Find the appropriate UID and GID to assign ownership</a></li>
          <li><a href="#create-the-fstab-entry" id="markdown-toc-create-the-fstab-entry">Create the fstab entry</a></li>
          <li><a href="#nas-conclusion" id="markdown-toc-nas-conclusion">NAS Conclusion</a></li>
        </ol>
      </li>
    </ol>
  </li>
</ol>

<h2 id="intro">Intro</h2>

<h3 id="edit-october-2020">Edit October 2020</h3>

<p>The original post dealt with setting up a share from an Ubuntu server to provide read/write access without a password. Since writing that part I purchased a Synology NAS and am now including sections on setting up shares for that.</p>

<p>Most SAMBA guides I find online are some combination of out of date or focused on the enterprise. My objective is to  provide a quick reference for setting up files shares from a Linux server to Windows clients, or to properly mount SAMBA shares from a NAS device onto Linux clients. This is only appropriate for a home network. In the case of the Linux server I’m sacrificing security/specific user permissions for being easily able to connect to my file share. On a small LAN where I can easily physically monitor the devices I think this is worth it. Clearly you should not do this for an organization or if you have more sensitive data you’re sharing.</p>

<h2 id="password-free-server-on-a-linux-box">Password free server on a Linux box</h2>

<h3 id="what-im-installing-this-on">What I’m installing this on</h3>

<p>The current server I’m running this on is an Ubuntu 18.04 machine. Hopefully most of this will translate to similar setups. I’m sure I’ll be upgrading the OS soon so I’ll edit this if I encounter any breaking changes.</p>

<h3 id="the-steps">The steps</h3>

<h4 id="install-samba">Install samba</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>samba
</code></pre></div></div>

<h4 id="backup-any-existing-smbconf-and-then-update">Backup any existing smb.conf and then update</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># If you have one already</span>
<span class="nb">sudo mv</span> /etc/samba/smb.conf /etc/samba/smb.conf.bak
</code></pre></div></div>

<p>Now setup the new <code class="language-plaintext highlighter-rouge">smb.conf</code>:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span>global]
        map to guest <span class="o">=</span> Bad User
        logging <span class="o">=</span> systemd
        log level <span class="o">=</span> 1
        guest account <span class="o">=</span> &lt;username&gt;

<span class="o">[</span>data]
        <span class="c"># This share allows guest read write access</span>
        <span class="c"># without authentication, hope you trust everyone on your LAN</span>
        path <span class="o">=</span> /mnt/data/ <span class="c"># Or whatever folder you're sharing</span>
        <span class="nb">read </span>only <span class="o">=</span> no
        guest ok <span class="o">=</span> <span class="nb">yes
        </span>guest only <span class="o">=</span> <span class="nb">yes</span>
</code></pre></div></div>

<p>Where &lt;username&gt; is the user on your samba server that has appropriate access to the folder you’re sharing.</p>

<p>After saving the config file you can run <code class="language-plaintext highlighter-rouge">testparm</code> to see if there are any syntax errors.</p>

<h4 id="restart-and-enable-samba-give-it-a-test">Restart and enable SAMBA, give it a test</h4>

<p>From the samba server:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl status smbd <span class="c"># check if it's running</span>
<span class="c"># If it's running do this</span>
<span class="nb">sudo </span>systemctl restart smbd
<span class="c"># If it's not do this</span>
<span class="nb">sudo </span>systemctl start smbd
</code></pre></div></div>

<p>Try and connect from a Windows machine, make sure you can create and delete files. Back on the samba client you can check if the files you created have the right permissions (should be assigned to the user you created).</p>

<p>Assuming everything works enable the server so it will reload if you restart the machine. From the samba server:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemclt <span class="nb">enable </span>smbd
</code></pre></div></div>

<h3 id="no-password-conclusion">No Password Conclusion</h3>

<p>That’s it! Super simple but every time I tried to get a SAMBA share going in the past I always ended up struggling. Hopefully this guide will be helpful to future me and anyone else who’s got a similar situation.</p>

<h2 id="mounting-shares-from-a-nas">Mounting shares from a NAS</h2>

<p>This part is pretty straightforward, but there are always a few finicky bits that I have to google, so I’m recording the process here for the next time I have to set it up. Setting up the actual share on the NAS is outside the scope of this article. In my case I’m using a Synology box so it’s pretty much just point and click.</p>

<h3 id="create-a-credentials-file">Create a credentials file</h3>

<p>I’m going to try and pay a reasonable amount of attention to security in this implementation. The NAS has a user set up with read and write permissions for the share that I want to access. I’ll use the <a href="https://wiki.archlinux.org/index.php/samba#Storing_share_passwords">suggestions from the Arch Wiki</a> to set up a credential file.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo mkdir</span> /etc/samba/credentials
<span class="nb">sudo echo</span> <span class="s2">"username=&lt;shareusername&gt;"</span> <span class="o">&gt;&gt;</span> /etc/samba/credentials/share
<span class="nb">sudo echo</span> <span class="s2">"password=&lt;sharepassword&gt;"</span> <span class="o">&gt;&gt;</span> /etc/samba/credentials/share
<span class="nb">sudo chown </span>root:root /etc/samba/credentials/share
<span class="nb">sudo chmod </span>700 /etc/samba/credentials
<span class="nb">sudo chmod </span>600 /etc/samba/credentials/share
</code></pre></div></div>

<h3 id="find-the-appropriate-uid-and-gid-to-assign-ownership">Find the appropriate UID and GID to assign ownership</h3>

<p>When creating the <code class="language-plaintext highlighter-rouge">/etc/fstab</code> entry for the share mount we want to assign ownership to the user that will actually be accessing the files. This is done by UID and GID. For my single user systems that’s usually 1000:1000 but I like to double check and I usually have to look up the command so here it is.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">id</span> <span class="nt">-u</span> &lt;username&gt;
<span class="nb">id</span> <span class="nt">-g</span> &lt;username&gt;
</code></pre></div></div>

<p>Will give the UID and GID for user <username></username></p>

<h3 id="create-the-fstab-entry">Create the fstab entry</h3>

<p>Now we just need to create an entry in fstab to the share:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>//&lt;server&gt;/&lt;share_path&gt; /mnt/&lt;share_point&gt; cifs _netdev,uid<span class="o">=</span>&lt;uid&gt;,gid<span class="o">=</span>&lt;gid&gt;,credentials<span class="o">=</span>/etc/samba/credentials/share 0 0
</code></pre></div></div>

<h3 id="nas-conclusion">NAS Conclusion</h3>

<p>This extension to the post just has a few code snippets that I’ve found useful. There’s not a lot of exposition on why I’ve set things up the way I did. It’s more meant as a reference for future me, but hopefully it’s useful to others.</p>
